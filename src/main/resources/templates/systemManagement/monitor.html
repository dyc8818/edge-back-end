<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{common/base :: Layout(~{::content},~{::title}, _,_,_,_,_,~{::monitorMenu},_,~{::scripts})}">
<title>实时监控</title>

<content>
    <div class="layui-fluid" style="padding: 0px;">

        <div class="layui-row">
            <br/>
            <br/>
            <br/>
            <br/>
            <div class="layui-col-lg10 layui-col-lg-offset1">
                <div id="numchart" style="width: 1400px;height:600px;"></div>
            </div>
        </div>

    </div>


</content>


<dd class="layui-this" th:fragment="monitorMenu">
    <a href="/pages/monitor">实时监控</a>
</dd>

<div th:fragment="scripts">
    <script th:src="@{/echarts-4.2.1/echarts.min.js}"></script>
    <script>
        // 基于准备好的dom，初始化echarts实例
        var numChart = echarts.init(document.getElementById('numchart'));
        var interval = 3000;
        var num = new Array();
        num.push([new Date(), 0]);

        var option = {
            title: {
                text: '设备在线数量',
                left:'center'
            },
            tooltip: {
                trigger: 'axis'
            },
            xAxis: {
                type:'time',
                name:'时间'
            },
            yAxis: {},
            series: [{
                name: '数量',
                type: 'line',
                data: num,
                symbol:'emptyDiamond',
                symbolSize: 8,
                lineStyle:{
                    width: 2
                }
            }]
        };
        // 使用刚指定的配置项和数据显示图表。
        numChart.setOption(option);

        setInterval(function(){
            var date = new Date();
            layui.use('jquery', function(){
                var $ = layui.$;
                //后面就跟你平时使用jQuery一样
                $.get("/api/surnum/",
                    function(data){
                        num.push([date,data]);
                        // 指定图表的配置项和数据
                        if(num.length>60){
                            num.shift();
                        }

                        // 使用刚指定的配置项和数据显示图表。
                        numChart.setOption(option);
                });

            });
        },interval)

    </script>


</div>
</html>